# üöÄ Render Deployment Guide for LevelUp App

This guide will walk you through deploying your LevelUp application to Render.

## üìã Prerequisites

1. **GitHub/GitLab Account**: Your code must be in a Git repository
2. **Render Account**: Sign up at [render.com](https://render.com)
3. **Neon Database**: Your PostgreSQL database (or use Render's PostgreSQL)

## üéØ Deployment Options

### Option 1: Blueprint Deployment (Recommended - Infrastructure as Code)

This uses the `render.yaml` file to automatically configure your service.

1. **Push to GitHub/GitLab**
   ```bash
   git add .
   git commit -m "Add Render configuration"
   git push origin main
   ```

2. **Create New Blueprint in Render**
   - Go to [Render Dashboard](https://dashboard.render.com/)
   - Click **"New" ‚Üí "Blueprint"**
   - Connect your GitHub/GitLab repository
   - Render will detect `render.yaml` automatically
   - Click **"Apply"**

3. **Configure Environment Variables**
   
   After the blueprint is applied, go to your web service and add these required environment variables:

   **Required:**
   - `DATABASE_URL`: Your Neon PostgreSQL connection string
     ```
     postgresql://user:password@host/database?sslmode=require
     ```
   - `SESSION_SECRET`: (Auto-generated by Render)
   - `APP_URL`: Your Render URL (e.g., `https://levelup-app.onrender.com`)

   **Optional (for full features):**
   - Google OAuth: `GOOGLE_CLIENT_ID`, `GOOGLE_CLIENT_SECRET`, `GOOGLE_CALLBACK_URL`
   - Email: `EMAIL_HOST`, `EMAIL_PORT`, `EMAIL_USER`, `EMAIL_PASS`, `EMAIL_FROM`
   - Push Notifications: `VAPID_PUBLIC_KEY`, `VAPID_PRIVATE_KEY`, `VAPID_SUBJECT`
   - AI Features: `GEMINI_API_KEY`

4. **Deploy**
   - Render will automatically build and deploy your app
   - Monitor the logs during deployment

---

### Option 2: Manual Web Service Creation

If you prefer manual setup:

1. **Create New Web Service**
   - Go to [Render Dashboard](https://dashboard.render.com/)
   - Click **"New" ‚Üí "Web Service"**
   - Connect your repository
   - Select your repository

2. **Configure Service**
   - **Name**: `levelup-app` (or your preferred name)
   - **Region**: Choose closest to your users
   - **Branch**: `main` (or your default branch)
   - **Runtime**: **Docker**
   - **Dockerfile Path**: `./Dockerfile`
   - **Docker Context**: `.`
   - **Docker Command**: (leave blank, uses CMD from Dockerfile)

3. **Plan Selection**
   - **Free**: Good for testing (sleeps after 15 min inactivity)
   - **Starter ($7/mo)**: For production (no sleep, better performance)

4. **Environment Variables**
   Add all the environment variables mentioned in Option 1

5. **Advanced Settings**
   - **Health Check Path**: `/api/auth/me`
   - **Auto-Deploy**: Enable

6. **Create Web Service**
   Click "Create Web Service" and wait for deployment

---

## üîß Environment Variables Setup

### Getting Your DATABASE_URL (Neon)

1. Go to your [Neon Dashboard](https://console.neon.tech/)
2. Select your project
3. Copy the connection string
4. Ensure it includes `?sslmode=require` at the end

Example:
```
postgresql://username:password@ep-xxx.us-east-2.aws.neon.tech/levelup?sslmode=require
```

### Setting APP_URL

After your service is created, Render assigns a URL like:
```
https://your-app-name.onrender.com
```

Update the `APP_URL` environment variable with this URL.

### Google OAuth Callback URL

If using Google OAuth, update your Google Cloud Console:
1. Go to [Google Cloud Console](https://console.cloud.google.com/)
2. Select your project
3. Go to **APIs & Services ‚Üí Credentials**
4. Edit your OAuth 2.0 Client ID
5. Add authorized redirect URI:
   ```
   https://your-app-name.onrender.com/api/auth/google/callback
   ```
6. Update `GOOGLE_CALLBACK_URL` in Render to match

---

## üì¶ Using Render's PostgreSQL (Alternative to Neon)

If you want to use Render's managed PostgreSQL instead of Neon:

1. **Create PostgreSQL Database**
   - In Render Dashboard, click **"New" ‚Üí "PostgreSQL"**
   - Name: `levelup-db`
   - Plan: Free or Starter
   - Create Database

2. **Link to Web Service**
   - Go to your web service
   - In Environment Variables, add:
     - Key: `DATABASE_URL`
     - Click "Use an existing database"
     - Select your `levelup-db`

3. **Initialize Database**
   ```bash
   # Install Render CLI (optional)
   npm install -g render

   # Or run migrations via npm script after deployment
   npm run db:push
   ```

---

## üîç Verification Steps

After deployment:

1. **Check Deployment Logs**
   - Look for "serving on port 10000" message
   - Verify no errors in the build process

2. **Test Your App**
   - Visit your Render URL
   - Test authentication
   - Check database connectivity

3. **Monitor Health**
   - Render Dashboard shows health check status
   - Green = healthy, Red = issues

---

## üêõ Troubleshooting

### App Not Starting

**Issue**: "Application failed to respond"
- Check that `PORT` env var is set (Render requires it)
- Verify Dockerfile builds successfully locally:
  ```bash
  docker build -t test-app .
  docker run -p 5000:5000 -e PORT=5000 test-app
  ```

### Database Connection Errors

**Issue**: "Connection refused" or timeout
- Verify `DATABASE_URL` is correct
- Ensure it ends with `?sslmode=require`
- Check Neon database is active (free tier may sleep)

### Build Failures

**Issue**: Build fails during `npm install`
- Check `package.json` and `package-lock.json` are committed
- Try clearing Render's build cache (Dashboard ‚Üí Settings ‚Üí Clear build cache)

### Session/Cookie Issues

**Issue**: Users can't stay logged in
- Verify `SESSION_SECRET` is set
- Check `APP_URL` matches your actual URL
- Ensure HTTPS is working (Render provides automatic SSL)

---

## üí° Performance Tips

### Free Tier Limitations
- **Sleeps after 15 min inactivity**: First request takes ~30 seconds
- **750 hours/month**: Shared across all free services
- **Limited resources**: 512 MB RAM

### Upgrading for Production
Consider upgrading to Starter plan ($7/mo) for:
- No sleep (always-on)
- Better performance
- More resources (512 MB+ RAM)

### Optimization Strategies
1. **Use CDN**: For static assets
2. **Database Connection Pooling**: Already configured via Neon
3. **Enable Redis**: For session storage (paid plans)

---

## üîÑ Auto-Deployment

Render automatically deploys when you push to your connected branch:

```bash
git add .
git commit -m "Update feature"
git push origin main
```

Render will:
1. Detect the push
2. Build your Docker image
3. Run health checks
4. Deploy with zero downtime (paid plans)

---

## üìä Monitoring & Logs

### View Logs
- Go to your service in Render Dashboard
- Click **"Logs"** tab
- Real-time streaming logs

### Monitor Resources
- **Metrics** tab shows:
  - CPU usage
  - Memory usage
  - Request rates
  - Response times

### Set Up Alerts
- Dashboard ‚Üí Settings ‚Üí Notifications
- Email alerts for:
  - Deploy failures
  - Service downtime
  - Resource limits

---

## üîê Security Checklist

- [ ] Use strong `SESSION_SECRET` (auto-generated by Render)
- [ ] Keep `DATABASE_URL` secret (never commit to Git)
- [ ] Use environment variables for all secrets
- [ ] Enable HTTPS (automatic on Render)
- [ ] Rotate API keys regularly
- [ ] Set up proper CORS if needed

---

## üìö Additional Resources

- [Render Documentation](https://render.com/docs)
- [Render Docker Deployment](https://render.com/docs/docker)
- [Render Environment Variables](https://render.com/docs/environment-variables)
- [Render PostgreSQL](https://render.com/docs/databases)

---

## üÜò Getting Help

If you encounter issues:

1. **Check Render Status**: [status.render.com](https://status.render.com)
2. **Render Community**: [community.render.com](https://community.render.com)
3. **Support**: Available for paid plans

---

## üéâ Next Steps

After successful deployment:

1. **Custom Domain** (Optional)
   - Dashboard ‚Üí Settings ‚Üí Custom Domain
   - Add your domain and configure DNS

2. **Database Backups**
   - Render PostgreSQL has automatic backups
   - Or backup Neon manually

3. **CI/CD Integration**
   - Render auto-deploys from Git
   - Add preview environments for PRs

4. **Monitoring Tools**
   - Integrate with tools like Sentry, LogRocket
   - Set up error tracking

---

Enjoy your deployed LevelUp app on Render! üöÄ
